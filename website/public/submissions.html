<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
    </script>
</head>

<body>
  <article>
    <h1>Submissions</h1>
    <label>Don't submit your code, just your output.</label>
    <input maxlength="64" type="text" id="submission-box" placeholder="paste output here">
    <span class='grid'>
      <button type="button" onclick="handleSubmit()">Submit</button>
    </span>
    <h4>Result: <em id="result"></em> </h4>
    <article>
      <h5>Past Submissions</h5>
    </article>
  </article>
</body>

<script>
  const getInputIndex = async () => {
    var index = 0;
    if (!getCookie('team')) {
      console.log('cant get index of empty team');
      return;
    }
    const res = fetch(`https://api.jstitt.dev/acmmm/sheet/get_index?team_name=${getCookie('team')}`,
      {method: 'GET'})
      .then(resp => resp.json())
      .then(data => {return data['index'];});
    return res;
  }

  const handleSubmit = async () => {
    const loc = window.location.href;
    // const lastSegmentOfUrl = window.location.href.substring(window.location.href.lastIndexOf('/') + 1);
    let part = loc.lastIndexOf('/') + 1;
    let prob = loc.substring(0, part - 1).slice(-1)
    let problem = prob + loc[part]

    let input_index = await getInputIndex();
    let output_value = $("#submission-box").val();
    fetch(`https://api.jstitt.dev/acmmm/sheet/get_judgement?problem=${problem}&input_index=${input_index}&output=${output_value}&team_name=${getCookie('team')}`,
      {method: "GET"})
      .then(resp => resp.json())
      .then(data => {
        if (data.judgement == "True") {
          $("#result").text("  Pass ✅");
        } else {
          $("#result").text("  Fail ❌").css({"color": "red"});
        }
      });
  }

</script>

<style>
  #result {
    color: lightgreen;
  }
</style>

</html>
